##-*- Mode: sh -*-
##---------------------------------------------------------------------------##
## .bashrc_darwin - my bash configuration file upon bash login
##---------------------------------------------------------------------------##

#verbose=true
if test -n "$verbose"; then
   echo "In .bashrc_darwin"
fi

##---------------------------------------------------------------------------##
## ENVIRONMENTS
##---------------------------------------------------------------------------##

# unlimit stack and core dump sizes.
ulimit -s unlimited

export VENDOR_DIR=/usr/projects/draco/vendors

# modules
if test -n "$MODULESHOME"; then
    module use --append ${VENDOR_DIR}/Modules

    # Nodes that have MIC capability use different modules...
    if test "$SLURM_JOB_PARTITION" = "knc-mic"; then
   #     mic_status=`/usr/sbin/micctrl -s | egrep mic[0-9]+ | wc -l`
        mic_status=1
    else
        mic_status=0
    fi

    if test ${mic_status} -gt 0; then
        # unload module that might conflict.
        module purge
        module load other/emacs-24.3 subversion python/2.7.3 random123
        # setup for draco
        module load compilers/intel/15.0.0 cmake/3.4.0
        module load mpi/intelmpi-5.0.1.035-mic
        module load numdiff/5.6.1-mic mkl/11.2-mic gsl/1.16-mic
        # additional setup for capsaicin
        module load ParMetis/4.0.3-mic SuperLU_DIST/3.3-mic trilinos/11.10.2-mic
    else
        # setup for draco
        module unload compilers mpi cmake
        module load other/emacs-24.3 subversion python/2.7.3 random123
        module load compilers/intel/15.0.3 cmake/3.4.0
        module load mpi/intelmpi-5.0.2.044
        module load numdiff/5.2.1 eospac/6.2.4 lapack/3.4.1 ndi
        # additional setup for capsaicin
        module load ParMetis/4.0.3 SuperLU_DIST/4.1 trilinos/12.0.1
    fi
    export CXX=`which mpiicpc`
    export CC=`which mpiicc`
    export FC=`which mpiifort`
    export MPIEXEC=`which mpirun`
fi

# Avoid printing trigraph chars to the screen (eg: ���)
export LANG=en_US

##---------------------------------------------------------------------------##
## end of .bashrc_darwin
##---------------------------------------------------------------------------##
